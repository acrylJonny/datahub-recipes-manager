{% extends "base.html" %}
{% load static %}

{% block title %}DataHub Glossary{% endblock %}

{% block extra_css %}
<style>
    .card-header-tabs {
        margin-right: -1.25rem;
        margin-bottom: -0.75rem;
        margin-left: -1.25rem;
        border-bottom: 0;
    }
    .glossary-card {
        margin-bottom: 1.5rem;
    }
    .glossary-item {
        transition: background-color 0.2s;
    }
    .glossary-item:hover {
        background-color: rgba(0,0,0,0.02);
    }
    .node-level-1 {
        padding-left: 1.5rem;
    }
    .node-level-2 {
        padding-left: 3rem;
    }
    .node-level-3 {
        padding-left: 4.5rem;
    }
    .badge-category {
        font-size: 0.8em;
        padding: 0.35em 0.65em;
    }
    .toggle-node-children {
        cursor: pointer;
        width: 18px;
        display: inline-block;
        text-align: center;
    }
    .toggle-node-children[aria-expanded="true"] .fa-caret-right {
        transform: rotate(90deg);
    }
    .glossary-node-children {
        border-left: 1px dashed #dee2e6;
        margin-left: 1.5rem;
    }
    .node-icon {
        width: 20px;
        display: inline-block;
        text-align: center;
    }
    .description-preview {
        max-height: 60px;
        overflow: hidden;
        color: #6c757d;
        font-size: 0.9em;
    }
    /* Responsive table */
    @media (max-width: 768px) {
        .responsive-table th:nth-child(3),
        .responsive-table td:nth-child(3) {
            display: none;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>DataHub Glossary</h1>
        <div>
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createNodeModal">
                        <i class="fas fa-folder-plus me-1"></i> Create Node
                    </button>
            <button type="button" class="btn btn-success ms-2" data-bs-toggle="modal" data-bs-target="#createTermModal">
                        <i class="fas fa-tag me-1"></i> Create Term
                    </button>
            <div class="dropdown d-inline-block ms-2">
                        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="batchActionsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="fas fa-tasks me-1"></i> Actions
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="batchActionsDropdown">
                            <li><h6 class="dropdown-header">Selected Items</h6></li>
                            <li><button type="button" class="dropdown-item" id="push-selected-items" {% if not has_datahub_connection %}disabled{% endif %}>
                                <i class="fas fa-cloud-upload-alt me-1"></i> Push to DataHub
                            </button></li>
                            <li><button type="button" class="dropdown-item" id="download-selected-items">
                                <i class="fas fa-download me-1"></i> Download Selected
                            </button></li>
                            {% if has_git_integration %}
                            <li><button type="button" class="dropdown-item" id="add-selected-to-git">
                                <i class="fab fa-github me-1"></i> Add to GitHub PR
                            </button></li>
                            {% endif %}
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">All Items</h6></li>
                            <li><button type="button" class="dropdown-item" id="push-all-items" {% if not has_datahub_connection %}disabled{% endif %}>
                                <i class="fas fa-cloud-upload-alt me-1"></i> Push All
                            </button></li>
                    <li><a href="{% url 'metadata_manager:glossary_pull' %}" class="dropdown-item">
                        <i class="fas fa-cloud-download-alt me-1"></i> Pull from DataHub
                    </a></li>
                    <li><a href="{% url 'metadata_manager:glossary_import_export' %}" class="dropdown-item">
                        <i class="fas fa-file-export me-1"></i> Import/Export
                    </a></li>
                        </ul>
                    </div>
                </div>
            </div>
            
            {% if not has_datahub_connection %}
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle me-1"></i> Not connected to DataHub. Please check your connection settings.
                </div>
            {% endif %}
            
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Glossary Sync Status Tabs -->
    <ul class="nav nav-tabs mb-4" id="glossarySyncTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="synced-tab" data-bs-toggle="tab" data-bs-target="#synced-glossary" 
                           type="button" role="tab" aria-controls="synced-glossary" aria-selected="true">
                        <i class="fas fa-sync-alt me-1"></i> Synced Items
                <span class="badge bg-success ms-1">{{ synced_count }}</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="local-tab" data-bs-toggle="tab" data-bs-target="#local-glossary" 
                           type="button" role="tab" aria-controls="local-glossary" aria-selected="false">
                        <i class="fas fa-laptop me-1"></i> Local Only Items
                <span class="badge bg-secondary ms-1">{{ local_only_count }}</span>
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="remote-tab" data-bs-toggle="tab" data-bs-target="#remote-glossary" 
                           type="button" role="tab" aria-controls="remote-glossary" aria-selected="false">
                        <i class="fas fa-server me-1"></i> Remote Only Items
                <span class="badge bg-info ms-1">{{ remote_only_count }}</span>
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="modified-tab" data-bs-toggle="tab" data-bs-target="#modified-glossary" 
                   type="button" role="tab" aria-controls="modified-glossary" aria-selected="false">
                <i class="fas fa-edit me-1"></i> Modified Items
                <span class="badge bg-warning ms-1">{{ modified_count }}</span>
                    </button>
                </li>
            </ul>

            <div class="tab-content" id="glossarySyncTabsContent">
                <!-- Synced Items Tab -->
                <div class="tab-pane fade show active" id="synced-glossary" role="tabpanel" aria-labelledby="synced-tab">
                    <div class="card mb-4">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Synced Glossary</h5>
                            <div class="d-flex">
                                <div class="input-group">
                                    <input type="text" id="synced-search" class="form-control form-control-sm me-2" 
                                           placeholder="Filter items..." value="">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="synced-clear-filter">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="ms-2">
                                    <a href="{% url 'metadata_manager:glossary_list' %}" class="btn btn-sm btn-outline-secondary" title="Refresh">
                                        <i class="fas fa-sync-alt"></i>
                                    </a>
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="expand-all-glossary" title="Expand All">
                                        <i class="fas fa-expand-alt"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="collapse-all-glossary" title="Collapse All">
                                        <i class="fas fa-compress-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0 responsive-table">
                            <thead>
                                <tr>
                                    <th width="2%">
                                        <input class="form-check-input" type="checkbox" id="select-all-synced">
                                    </th>
                                    <th width="35%">Name</th>
                                    <th width="40%">Description</th>
                                    <th width="8%">Type</th>
                                    <th width="15%">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Root level nodes section -->
                                <tr class="glossary-tree-header">
                                    <td colspan="5" class="bg-light">
                                        <div class="d-flex align-items-center">
                                            <span class="toggle-node-children me-2" data-bs-toggle="collapse" data-bs-target="#synced-root-nodes" role="button" aria-expanded="true" aria-controls="synced-root-nodes">
                                                <i class="fas fa-caret-right"></i>
                                            </span>
                                            <span class="node-icon me-2">
                                                <i class="fas fa-folder text-warning"></i>
                                            </span>
                                            <span><strong>Root Level Nodes</strong></span>
                                            {% with root_nodes_count=synced_nodes|length %}
                                            {% if root_nodes_count > 0 %}
                                            <span class="badge bg-warning ms-2">{{ root_nodes_count }}</span>
                                            {% endif %}
                                            {% endwith %}
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr class="collapse show" id="synced-root-nodes">
                                    <td colspan="5" class="p-0">
                                        <table class="table table-hover mb-0 w-100">
                                            {% for node in synced_nodes %}
                                            <tr class="glossary-item node-item">
                                                <td width="2%">
                                                    <input class="form-check-input node-checkbox" type="checkbox" data-node-id="{{ node.id }}" data-item-type="node">
                                                </td>
                                                <td width="35%">
                                                    <div class="d-flex align-items-center">
                                                        <span class="toggle-node-children me-2" {% if node.children.exists or node.terms.exists %}data-bs-toggle="collapse" data-bs-target="#node-{{ node.id }}-children"{% else %}style="visibility: hidden;"{% endif %}>
                                                            <i class="fas fa-caret-right"></i>
                                                        </span>
                                                        <span class="node-icon me-2">
                                                            <i class="fas fa-folder text-warning"></i>
                                                        </span>
                                                        <a href="{% url 'metadata_manager:glossary_node_detail' node.id %}" class="text-decoration-none">
                                                            {{ node.name }}
                                                        </a>
                                                        <span class="badge bg-success ms-2">Synced</span>
                                                    </div>
                                                </td>
                                                <td width="40%">
                                                    <div class="description-preview">{{ node.description|default:"No description" }}</div>
                                                </td>
                                                <td width="8%">
                                                    <span class="badge bg-warning badge-category">Node</span>
                                                </td>
                                                <td width="15%">
                                                    <div class="btn-group" role="group">
                                                        <a href="{% url 'metadata_manager:glossary_node_detail' node.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                            <i class="fas fa-eye"></i>
                                                        </a>
                                                        <a href="{% url 'metadata_manager:glossary_node_detail' node.id %}" class="btn btn-sm btn-outline-secondary" title="Edit">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                        {% if has_git_integration %}
                                                        <button type="button" class="btn btn-sm btn-outline-primary add-node-to-git-pr" 
                                                                data-node-id="{{ node.id }}" title="Add to GitHub PR">
                                                            <i class="fab fa-github"></i>
                                                        </button>
                                                        {% endif %}
                                                        <button type="button" class="btn btn-sm btn-outline-danger delete-node" 
                                                                data-bs-toggle="modal" data-bs-target="#deleteNodeModal"
                                                                data-node-id="{{ node.id }}" data-node-name="{{ node.name }}" title="Delete">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            
                                            <!-- Node's children and terms -->
                                            {% if node.children.exists or node.terms.exists %}
                                            <tr class="collapse" id="node-{{ node.id }}-children">
                                                <td colspan="5" class="p-0">
                                                    <table class="table table-hover mb-0 w-100">
                                                        {% for child in node.children.all %}
                                                        <tr class="glossary-item node-item node-level-1">
                                                            <td width="2%">
                                                                <input class="form-check-input node-checkbox" type="checkbox" data-node-id="{{ child.id }}" data-item-type="node">
                                                            </td>
                                                            <td width="35%">
                                                                <div class="d-flex align-items-center">
                                                                    <span class="toggle-node-children me-2" {% if child.children.exists or child.terms.exists %}data-bs-toggle="collapse" data-bs-target="#node-{{ child.id }}-children"{% else %}style="visibility: hidden;"{% endif %}>
                                                                        <i class="fas fa-caret-right"></i>
                                                                    </span>
                                                                    <span class="node-icon me-2">
                                                                        <i class="fas fa-folder text-warning"></i>
                                                                    </span>
                                                                    <a href="{% url 'metadata_manager:glossary_node_detail' child.id %}" class="text-decoration-none">
                                                                        {{ child.name }}
                                                                    </a>
                                                                    <span class="badge bg-success ms-2">Synced</span>
                                                                </div>
                                                            </td>
                                                            <td width="40%">
                                                                <div class="description-preview">{{ child.description|default:"No description" }}</div>
                                                            </td>
                                                            <td width="8%">
                                                                <span class="badge bg-warning badge-category">Node</span>
                                                            </td>
                                                            <td width="15%">
                                                                <div class="btn-group" role="group">
                                                                    <a href="{% url 'metadata_manager:glossary_node_detail' child.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                                        <i class="fas fa-eye"></i>
                                                                    </a>
                                                                    <a href="{% url 'metadata_manager:glossary_node_detail' child.id %}" class="btn btn-sm btn-outline-secondary" title="Edit">
                                                                        <i class="fas fa-edit"></i>
                                                                    </a>
                                                                    {% if has_git_integration %}
                                                                    <button type="button" class="btn btn-sm btn-outline-primary add-node-to-git-pr" 
                                                                            data-node-id="{{ child.id }}" title="Add to GitHub PR">
                                                                        <i class="fab fa-github"></i>
                                                                    </button>
                                                                    {% endif %}
                                                                    <button type="button" class="btn btn-sm btn-outline-danger delete-node" 
                                                                            data-bs-toggle="modal" data-bs-target="#deleteNodeModal"
                                                                            data-node-id="{{ child.id }}" data-node-name="{{ child.name }}" title="Delete">
                                                                        <i class="fas fa-trash"></i>
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                        
                                                        {% for term in node.terms.all %}
                                                        <tr class="glossary-item term-item node-level-1">
                                                            <td width="2%">
                                                                <input class="form-check-input term-checkbox" type="checkbox" data-term-id="{{ term.id }}" data-item-type="term">
                                                            </td>
                                                            <td width="35%">
                                                                <div class="d-flex align-items-center">
                                                                    <span class="toggle-node-children invisible me-2">
                                                                        <i class="fas fa-caret-right"></i>
                                                                    </span>
                                                                    <span class="node-icon me-2">
                                                                        <i class="fas fa-tag text-info"></i>
                                                                    </span>
                                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="text-decoration-none">
                                                                        {{ term.name }}
                                                                    </a>
                                                                    <span class="badge bg-success ms-2">Synced</span>
                                                                </div>
                                                            </td>
                                                            <td width="40%">
                                                                <div class="description-preview">{{ term.description|default:"No description" }}</div>
                                                            </td>
                                                            <td width="8%">
                                                                <span class="badge bg-info badge-category">Term</span>
                                                            </td>
                                                            <td width="15%">
                                                                <div class="btn-group" role="group">
                                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                                        <i class="fas fa-eye"></i>
                                                                    </a>
                                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-secondary" title="Edit">
                                                                        <i class="fas fa-edit"></i>
                                                                    </a>
                                                                    {% if has_git_integration %}
                                                                    <button type="button" class="btn btn-sm btn-outline-primary add-term-to-git-pr" 
                                                                            data-term-id="{{ term.id }}" title="Add to GitHub PR">
                                                                        <i class="fab fa-github"></i>
                                                                    </button>
                                                                    {% endif %}
                                                                    <button type="button" class="btn btn-sm btn-outline-danger delete-term" 
                                                                            data-bs-toggle="modal" data-bs-target="#deleteTermModal"
                                                                            data-term-id="{{ term.id }}" data-term-name="{{ term.name }}" title="Delete">
                                                                        <i class="fas fa-trash"></i>
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </table>
                                                </td>
                                            </tr>
                                            {% endif %}
                                            {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                                
                                <!-- Root level terms section -->
                                <tr class="glossary-tree-header">
                                    <td colspan="5" class="bg-light">
                                    <div class="d-flex align-items-center">
                                            <span class="toggle-node-children me-2" data-bs-toggle="collapse" data-bs-target="#synced-root-terms" role="button" aria-expanded="true" aria-controls="synced-root-terms">
                                            <i class="fas fa-caret-right"></i>
                                        </span>
                                        <span class="node-icon me-2">
                                                <i class="fas fa-tags text-info"></i>
                                        </span>
                                        <span><strong>Root Level Terms</strong></span>
                                        {% with root_terms_count=synced_root_terms|length %}
                                        {% if root_terms_count > 0 %}
                                        <span class="badge bg-info ms-2">{{ root_terms_count }}</span>
                                        {% endif %}
                                        {% endwith %}
                                    </div>
                                    </td>
                                </tr>
                                
                                <tr class="collapse show" id="synced-root-terms">
                                    <td colspan="5" class="p-0">
                                        <table class="table table-hover mb-0 w-100">
                                        {% for term in synced_root_terms %}
                                            <tr class="glossary-item term-item">
                                                <td width="2%">
                                                        <input class="form-check-input term-checkbox" type="checkbox" data-term-id="{{ term.id }}" data-item-type="term">
                                                </td>
                                                <td width="35%">
                                                    <div class="d-flex align-items-center">
                                                    <span class="toggle-node-children invisible me-2">
                                                        <i class="fas fa-caret-right"></i>
                                                    </span>
                                                    <span class="node-icon me-2">
                                                        <i class="fas fa-tag text-info"></i>
                                                    </span>
                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="text-decoration-none">
                                                            {{ term.name }}
                                                        </a>
                                                    <span class="badge bg-success ms-2">Synced</span>
                                                </div>
                                                </td>
                                                <td width="40%">
                                                    <div class="description-preview">{{ term.description|default:"No description" }}</div>
                                                </td>
                                                <td width="8%">
                                                    <span class="badge bg-info badge-category">Term</span>
                                                </td>
                                                <td width="15%">
                                                    <div class="btn-group" role="group">
                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                        <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-secondary" title="Edit">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                    {% if has_git_integration %}
                                                    <button type="button" class="btn btn-sm btn-outline-primary add-term-to-git-pr" 
                                                            data-term-id="{{ term.id }}" title="Add to GitHub PR">
                                                        <i class="fab fa-github"></i>
                                                    </button>
                                                    {% endif %}
                                                    <button type="button" class="btn btn-sm btn-outline-danger delete-term" 
                                                            data-bs-toggle="modal" data-bs-target="#deleteTermModal"
                                                            data-term-id="{{ term.id }}" data-term-name="{{ term.name }}" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Local Only Items Tab -->
                <div class="tab-pane fade" id="local-glossary" role="tabpanel" aria-labelledby="local-tab">
                    <div class="card mb-4">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Local Only Glossary</h5>
                            <div class="d-flex">
                                <div class="input-group">
                                    <input type="text" id="local-search" class="form-control form-control-sm me-2" 
                                           placeholder="Filter items..." value="">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="local-clear-filter">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="ms-2">
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="expand-all-local" title="Expand All">
                                        <i class="fas fa-expand-alt"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="collapse-all-local" title="Collapse All">
                                        <i class="fas fa-compress-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0 responsive-table">
                            <thead>
                                <tr>
                                    <th width="2%">
                                        <input class="form-check-input" type="checkbox" id="select-all-local">
                                    </th>
                                    <th width="35%">Name</th>
                                    <th width="40%">Description</th>
                                    <th width="8%">Type</th>
                                    <th width="15%">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Root level terms section -->
                                <tr class="glossary-tree-header">
                                    <td colspan="5" class="bg-light">
                                    <div class="d-flex align-items-center">
                                            <span class="toggle-node-children me-2" data-bs-toggle="collapse" data-bs-target="#local-root-terms" role="button" aria-expanded="true" aria-controls="local-root-terms">
                                            <i class="fas fa-caret-right"></i>
                                        </span>
                                        <span class="node-icon me-2">
                                                <i class="fas fa-tags text-info"></i>
                                        </span>
                                        <span><strong>Root Level Terms</strong></span>
                                        {% with root_terms_count=local_only_root_terms|length %}
                                        {% if root_terms_count > 0 %}
                                        <span class="badge bg-info ms-2">{{ root_terms_count }}</span>
                                        {% endif %}
                                        {% endwith %}
                                    </div>
                                    </td>
                                </tr>
                                
                                <tr class="collapse show" id="local-root-terms">
                                    <td colspan="5" class="p-0">
                                        <table class="table table-hover mb-0 w-100">
                                        {% for term in local_only_root_terms %}
                                            <tr class="glossary-item term-item">
                                                <td width="2%">
                                                        <input class="form-check-input term-checkbox" type="checkbox" data-term-id="{{ term.id }}" data-item-type="term">
                                                </td>
                                                <td width="35%">
                                                    <div class="d-flex align-items-center">
                                                    <span class="toggle-node-children invisible me-2">
                                                        <i class="fas fa-caret-right"></i>
                                                    </span>
                                                    <span class="node-icon me-2">
                                                        <i class="fas fa-tag text-info"></i>
                                                    </span>
                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="text-decoration-none">
                                                            {{ term.name }}
                                                    </a>
                                                    <span class="badge bg-secondary ms-2">Local Only</span>
                                                </div>
                                                </td>
                                                <td width="40%">
                                                    <div class="description-preview">{{ term.description|default:"No description" }}</div>
                                                </td>
                                                <td width="8%">
                                                    <span class="badge bg-info badge-category">Term</span>
                                                </td>
                                                <td width="15%">
                                                    <div class="btn-group" role="group">
                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    {% if term.can_deploy and has_datahub_connection %}
                                                    <form action="{% url 'metadata_manager:glossary_term_deploy' term.id %}" method="post" class="d-inline">
                                                        {% csrf_token %}
                                                        <button type="submit" class="btn btn-sm btn-outline-primary" title="Deploy to DataHub">
                                                            <i class="fas fa-cloud-upload-alt"></i>
                                                        </button>
                                                    </form>
                                                    {% endif %}
                                                    <button type="button" class="btn btn-sm btn-outline-danger delete-term" 
                                                            data-bs-toggle="modal" data-bs-target="#deleteTermModal"
                                                            data-term-id="{{ term.id }}" data-term-name="{{ term.name }}" title="Delete">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                                
                                <!-- Root level nodes section -->
                                <tr class="glossary-tree-header">
                                    <td colspan="5" class="bg-light">
                                        <div class="d-flex align-items-center">
                                            <span class="toggle-node-children me-2" data-bs-toggle="collapse" data-bs-target="#local-root-nodes" role="button" aria-expanded="true" aria-controls="local-root-nodes">
                                                <i class="fas fa-caret-right"></i>
                                            </span>
                                            <span class="node-icon me-2">
                                                <i class="fas fa-folder text-warning"></i>
                                            </span>
                                            <span><strong>Root Level Nodes</strong></span>
                                            {% with root_nodes_count=local_only_nodes|length %}
                                            {% if root_nodes_count > 0 %}
                                            <span class="badge bg-warning ms-2">{{ root_nodes_count }}</span>
                                            {% endif %}
                                            {% endwith %}
                                    </div>
                                    </td>
                                </tr>
                                
                                <tr class="collapse show" id="local-root-nodes">
                                    <td colspan="5" class="p-0">
                                        <table class="table table-hover mb-0 w-100">
                                {% for node in local_only_nodes %}
                                            <tr class="glossary-item node-item">
                                                <td width="2%">
                                                    <input class="form-check-input node-checkbox" type="checkbox" data-node-id="{{ node.id }}" data-item-type="node">
                                                </td>
                                                <td width="35%">
                                                    <div class="d-flex align-items-center">
                                                        <span class="toggle-node-children me-2" {% if node.children|length > 0 or node.terms|length > 0 %}data-bs-toggle="collapse" data-bs-target="#local-node-{{ node.id }}-children"{% else %}style="visibility: hidden;"{% endif %}>
                                                            <i class="fas fa-caret-right"></i>
                                                        </span>
                                                        <span class="node-icon me-2">
                                                            <i class="fas fa-folder text-warning"></i>
                                                        </span>
                                                        <a href="{% url 'metadata_manager:glossary_node_detail' node.id %}" class="text-decoration-none">
                                                            {{ node.name }}
                                                        </a>
                                                        <span class="badge bg-secondary ms-2">Local Only</span>
                                                    </div>
                                                </td>
                                                <td width="40%">
                                                    <div class="description-preview">{{ node.description|default:"No description" }}</div>
                                                </td>
                                                <td width="8%">
                                                    <span class="badge bg-warning badge-category">Node</span>
                                                </td>
                                                <td width="15%">
                                                    <div class="btn-group" role="group">
                                                        <a href="{% url 'metadata_manager:glossary_node_detail' node.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                            <i class="fas fa-eye"></i>
                                                        </a>
                                                        {% if node.can_deploy and has_datahub_connection %}
                                                        <form action="{% url 'metadata_manager:glossary_node_deploy' node.id %}" method="post" class="d-inline">
                                                            {% csrf_token %}
                                                            <button type="submit" class="btn btn-sm btn-outline-primary" title="Deploy to DataHub">
                                                                <i class="fas fa-cloud-upload-alt"></i>
                                                            </button>
                                                        </form>
                                    {% endif %}
                                                        <button type="button" class="btn btn-sm btn-outline-danger delete-node" 
                                                                data-bs-toggle="modal" data-bs-target="#deleteNodeModal"
                                                                data-node-id="{{ node.id }}" data-node-name="{{ node.name }}" title="Delete">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            
                                            <!-- Node's children and terms -->
                                            {% if node.children|length > 0 or node.terms|length > 0 %}
                                            <tr class="collapse" id="local-node-{{ node.id }}-children">
                                                <td colspan="5" class="p-0">
                                                    <table class="table table-hover mb-0 w-100">
                                                        {% for child in node.children %}
                                                        <tr class="glossary-item node-item node-level-1">
                                                            <td width="2%">
                                                                <input class="form-check-input node-checkbox" type="checkbox" data-node-id="{{ child.id }}" data-item-type="node">
                                                            </td>
                                                            <td width="35%">
                                                                <div class="d-flex align-items-center">
                                                                    <span class="toggle-node-children me-2" {% if child.children|length > 0 or child.terms|length > 0 %}data-bs-toggle="collapse" data-bs-target="#local-node-{{ child.id }}-children"{% else %}style="visibility: hidden;"{% endif %}>
                                                                        <i class="fas fa-caret-right"></i>
                                                                    </span>
                                                                    <span class="node-icon me-2">
                                                                        <i class="fas fa-folder text-warning"></i>
                                                                    </span>
                                                                    <a href="{% url 'metadata_manager:glossary_node_detail' child.id %}" class="text-decoration-none">
                                                                        {{ child.name }}
                                                                    </a>
                                                                    <span class="badge bg-secondary ms-2">Local Only</span>
                                                                </div>
                                                            </td>
                                                            <td width="40%">
                                                                <div class="description-preview">{{ child.description|default:"No description" }}</div>
                                                            </td>
                                                            <td width="8%">
                                                                <span class="badge bg-warning badge-category">Node</span>
                                                            </td>
                                                            <td width="15%">
                                                                <div class="btn-group" role="group">
                                                                    <a href="{% url 'metadata_manager:glossary_node_detail' child.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                                        <i class="fas fa-eye"></i>
                                                                    </a>
                                                                    {% if child.can_deploy and has_datahub_connection %}
                                                                    <form action="{% url 'metadata_manager:glossary_node_deploy' child.id %}" method="post" class="d-inline">
                                                                        {% csrf_token %}
                                                                        <button type="submit" class="btn btn-sm btn-outline-primary" title="Deploy to DataHub">
                                                                            <i class="fas fa-cloud-upload-alt"></i>
                                                                        </button>
                                                                    </form>
                                                                    {% endif %}
                                                                    <button type="button" class="btn btn-sm btn-outline-danger delete-node" 
                                                                            data-bs-toggle="modal" data-bs-target="#deleteNodeModal"
                                                                            data-node-id="{{ child.id }}" data-node-name="{{ child.name }}" title="Delete">
                                                                        <i class="fas fa-trash"></i>
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                {% endfor %}
                                                        
                                                        {% for term in node.terms %}
                                                        <tr class="glossary-item term-item node-level-1">
                                                            <td width="2%">
                                                                <input class="form-check-input term-checkbox" type="checkbox" data-term-id="{{ term.id }}" data-item-type="term">
                                                            </td>
                                                            <td width="35%">
                                                                <div class="d-flex align-items-center">
                                                                    <span class="toggle-node-children invisible me-2">
                                                                        <i class="fas fa-caret-right"></i>
                                                                    </span>
                                                                    <span class="node-icon me-2">
                                                                        <i class="fas fa-tag text-info"></i>
                                                                    </span>
                                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="text-decoration-none">
                                                                        {{ term.name }}
                                                                    </a>
                                                                    <span class="badge bg-secondary ms-2">Local Only</span>
                            </div>
                                                            </td>
                                                            <td width="40%">
                                                                <div class="description-preview">{{ term.description|default:"No description" }}</div>
                                                            </td>
                                                            <td width="8%">
                                                                <span class="badge bg-info badge-category">Term</span>
                                                            </td>
                                                            <td width="15%">
                                                                <div class="btn-group" role="group">
                                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                                        <i class="fas fa-eye"></i>
                                                                    </a>
                                                                    {% if term.can_deploy and has_datahub_connection %}
                                                                    <form action="{% url 'metadata_manager:glossary_term_deploy' term.id %}" method="post" class="d-inline">
                                                                        {% csrf_token %}
                                                                        <button type="submit" class="btn btn-sm btn-outline-primary" title="Deploy to DataHub">
                                                                            <i class="fas fa-cloud-upload-alt"></i>
                                                                        </button>
                                                                    </form>
                                                                    {% endif %}
                                                                    <button type="button" class="btn btn-sm btn-outline-danger delete-term" 
                                                                            data-bs-toggle="modal" data-bs-target="#deleteTermModal"
                                                                            data-term-id="{{ term.id }}" data-term-name="{{ term.name }}" title="Delete">
                                                                        <i class="fas fa-trash"></i>
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </table>
                                                </td>
                                            </tr>
                                            {% endif %}
                                            {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                        </div>
                    </div>
                </div>
                
                <!-- Remote Only Items Tab -->
                <div class="tab-pane fade" id="remote-glossary" role="tabpanel" aria-labelledby="remote-tab">
                    <div class="card mb-4">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Remote Only Glossary</h5>
                            <div class="d-flex">
                                <div class="input-group">
                                    <input type="text" id="remote-search" class="form-control form-control-sm me-2" 
                                           placeholder="Filter items..." value="">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" id="remote-clear-filter">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <div class="ms-2">
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="expand-all-remote" title="Expand All">
                                        <i class="fas fa-expand-alt"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="collapse-all-remote" title="Collapse All">
                                        <i class="fas fa-compress-alt"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0 responsive-table">
                            <thead>
                                <tr>
                                    <th width="2%">
                                        <input class="form-check-input" type="checkbox" id="select-all-remote">
                                    </th>
                                    <th width="35%">Name</th>
                                    <th width="40%">Description</th>
                                    <th width="8%">Type</th>
                                    <th width="15%">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                                                 <!-- Root level terms section -->
                                <tr class="glossary-tree-header">
                                    <td colspan="5" class="bg-light">
                                    <div class="d-flex align-items-center">
                                            <span class="toggle-node-children me-2" data-bs-toggle="collapse" data-bs-target="#remote-root-terms" role="button" aria-expanded="true" aria-controls="remote-root-terms">
                                            <i class="fas fa-caret-right"></i>
                                        </span>
                                        <span class="node-icon me-2">
                                                <i class="fas fa-tags text-info"></i>
                                        </span>
                                        <span><strong>Root Level Terms</strong></span>
                                        {% with root_terms_count=remote_only_root_terms|length %}
                                        {% if root_terms_count > 0 %}
                                        <span class="badge bg-info ms-2">{{ root_terms_count }}</span>
                                        {% endif %}
                                        {% endwith %}
                                    </div>
                                    </td>
                                </tr>
                                
                                <tr class="collapse show" id="remote-root-terms">
                                    <td colspan="5" class="p-0">
                                        <table class="table table-hover mb-0 w-100">
                                        {% for term in remote_only_root_terms %}
                                            <tr class="glossary-item term-item">
                                                <td width="2%">
                                                        <input class="form-check-input term-checkbox" type="checkbox" data-term-urn="{{ term.urn }}" data-item-type="term">
                                                </td>
                                                <td width="35%">
                                                    <div class="d-flex align-items-center">
                                                    <span class="toggle-node-children invisible me-2">
                                                        <i class="fas fa-caret-right"></i>
                                                    </span>
                                                    <span class="node-icon me-2">
                                                        <i class="fas fa-tag text-info"></i>
                                                    </span>
                                                        <span>{{ term.properties.name }}</span>
                                                    <span class="badge bg-info ms-2">Remote Only</span>
                                                </div>
                                                </td>
                                                <td width="40%">
                                                    <div class="description-preview">{{ term.properties.description|default:"No description" }}</div>
                                                </td>
                                                <td width="8%">
                                                    <span class="badge bg-info badge-category">Term</span>
                                                </td>
                                                <td width="15%">
                                                    <div class="btn-group" role="group">
                                                    <form action="{% url 'metadata_manager:glossary_term_pull' %}" method="post" class="d-inline">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="term_urns" value="{{ term.urn }}">
                                                        <button type="submit" class="btn btn-sm btn-outline-primary" title="Pull from DataHub">
                                                            <i class="fas fa-cloud-download-alt"></i>
                                                        </button>
                                                    </form>
                                                </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                                
                                <!-- Root level nodes section -->
                                <tr class="glossary-tree-header">
                                    <td colspan="5" class="bg-light">
                                            <div class="d-flex align-items-center">
                                            <span class="toggle-node-children me-2" data-bs-toggle="collapse" data-bs-target="#remote-root-nodes" role="button" aria-expanded="true" aria-controls="remote-root-nodes">
                                                    <i class="fas fa-caret-right"></i>
                                                </span>
                                            <span class="node-icon me-2">
                                                <i class="fas fa-folder text-warning"></i>
                                                </span>
                                            <span><strong>Root Level Nodes</strong></span>
                                            {% with root_nodes_count=remote_only_nodes|length %}
                                            {% if root_nodes_count > 0 %}
                                            <span class="badge bg-warning ms-2">{{ root_nodes_count }}</span>
                                                {% endif %}
                                            {% endwith %}
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr class="collapse show" id="remote-root-nodes">
                                    <td colspan="5" class="p-0">
                                        <table class="table table-hover mb-0 w-100">
                                            {% for node in remote_only_nodes %}
                                            <tr class="glossary-item node-item">
                                                <td width="2%">
                                                    <input class="form-check-input node-checkbox" type="checkbox" data-node-urn="{{ node.urn }}" data-item-type="node">
                                                </td>
                                                <td width="35%">
                                                    <div class="d-flex align-items-center">
                                                        <span class="toggle-node-children me-2" {% if node.childNodes or node.terms %}data-bs-toggle="collapse" data-bs-target="#remote-node-{{ forloop.counter }}-children"{% else %}style="visibility: hidden;"{% endif %}>
                                                            <i class="fas fa-caret-right"></i>
                                                        </span>
                                                <span class="node-icon me-2">
                                                    <i class="fas fa-folder text-warning"></i>
                                                </span>
                                                        <span>{{ node.properties.name }}</span>
                                                <span class="badge bg-info ms-2">Remote Only</span>
                                            </div>
                                                </td>
                                                <td width="40%">
                                                    <div class="description-preview">{{ node.properties.description|default:"No description" }}</div>
                                                </td>
                                                <td width="8%">
                                                    <span class="badge bg-warning badge-category">Node</span>
                                                </td>
                                                <td width="15%">
                                                    <div class="btn-group" role="group">
                                                <form action="{% url 'metadata_manager:glossary_node_pull' %}" method="post" class="d-inline">
                                                    {% csrf_token %}
                                                    <input type="hidden" name="node_urns" value="{{ node.urn }}">
                                                    <button type="submit" class="btn btn-sm btn-outline-primary" title="Pull from DataHub">
                                                        <i class="fas fa-cloud-download-alt"></i>
                                                    </button>
                                                </form>
                                            </div>
                                                </td>
                                            </tr>
                                        
                                            <!-- Node's children and terms -->
                                        {% if node.childNodes or node.terms %}
                                            <tr class="collapse" id="remote-node-{{ forloop.counter }}-children">
                                                <td colspan="5" class="p-0">
                                                    <table class="table table-hover mb-0 w-100">
                                                {% for child_node in node.childNodes %}
                                                        <tr class="glossary-item node-item node-level-1">
                                                            <td width="2%">
                                                                <input class="form-check-input node-checkbox" type="checkbox" data-node-urn="{{ child_node.urn }}" data-item-type="node">
                                                            </td>
                                                            <td width="35%">
                                                                <div class="d-flex align-items-center">
                                                                    <span class="toggle-node-children me-2" {% if child_node.childNodes or child_node.terms %}data-bs-toggle="collapse" data-bs-target="#remote-node-{{ forloop.parentloop.counter }}-{{ forloop.counter }}-children"{% else %}style="visibility: hidden;"{% endif %}>
                                                                        <i class="fas fa-caret-right"></i>
                                                                    </span>
                                                                    <span class="node-icon me-2">
                                                                        <i class="fas fa-folder text-warning"></i>
                                                                    </span>
                                                                    <span>{{ child_node.properties.name }}</span>
                                                                    <span class="badge bg-info ms-2">Remote Only</span>
                                                                </div>
                                                            </td>
                                                            <td width="40%">
                                                                <div class="description-preview">{{ child_node.properties.description|default:"No description" }}</div>
                                                            </td>
                                                            <td width="8%">
                                                                <span class="badge bg-warning badge-category">Node</span>
                                                            </td>
                                                            <td width="15%">
                                                                <div class="btn-group" role="group">
                                                                    <form action="{% url 'metadata_manager:glossary_node_pull' %}" method="post" class="d-inline">
                                                                        {% csrf_token %}
                                                                        <input type="hidden" name="node_urns" value="{{ child_node.urn }}">
                                                                        <button type="submit" class="btn btn-sm btn-outline-primary" title="Pull from DataHub">
                                                                            <i class="fas fa-cloud-download-alt"></i>
                                                                        </button>
                                                                    </form>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                {% endfor %}
                                                
                                                {% for term in node.terms %}
                                                        <tr class="glossary-item term-item node-level-1">
                                                            <td width="2%">
                                                                <input class="form-check-input term-checkbox" type="checkbox" data-term-urn="{{ term.urn }}" data-item-type="term">
                                                            </td>
                                                            <td width="35%">
                                                                <div class="d-flex align-items-center">
                                                            <span class="toggle-node-children invisible me-2">
                                                                <i class="fas fa-caret-right"></i>
                                                            </span>
                                                            <span class="node-icon me-2">
                                                                <i class="fas fa-tag text-info"></i>
                                                            </span>
                                                                    <span>{{ term.properties.name }}</span>
                                                            <span class="badge bg-info ms-2">Remote Only</span>
                                                        </div>
                                                            </td>
                                                            <td width="40%">
                                                                <div class="description-preview">{{ term.properties.description|default:"No description" }}</div>
                                                            </td>
                                                            <td width="8%">
                                                                <span class="badge bg-info badge-category">Term</span>
                                                            </td>
                                                            <td width="15%">
                                                                <div class="btn-group" role="group">
                                                            <form action="{% url 'metadata_manager:glossary_term_pull' %}" method="post" class="d-inline">
                                                                {% csrf_token %}
                                                                <input type="hidden" name="term_urns" value="{{ term.urn }}">
                                                                <button type="submit" class="btn btn-sm btn-outline-primary" title="Pull from DataHub">
                                                                    <i class="fas fa-cloud-download-alt"></i>
                                                                </button>
                                                            </form>
                                                        </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </table>
                                                </td>
                                            </tr>
                                            {% endif %}
                                            {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                                                    </div>
                </div>
            </div>
        </div>
        
        <!-- Modified Items Tab -->
        <div class="tab-pane fade" id="modified-glossary" role="tabpanel" aria-labelledby="modified-tab">
            <div class="card mb-4">
                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Modified Items</h5>
                    <div class="d-flex">
                        <div class="input-group">
                            <input type="text" id="modified-search" class="form-control form-control-sm me-2" 
                                   placeholder="Filter items..." value="">
                            <button type="button" class="btn btn-sm btn-outline-secondary" id="modified-clear-filter">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="ms-2">
                            <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="expand-all-modified" title="Expand All">
                                <i class="fas fa-expand-alt"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="collapse-all-modified" title="Collapse All">
                                <i class="fas fa-compress-alt"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover table-striped mb-0 responsive-table">
                            <thead>
                                <tr>
                                    <th width="2%">
                                        <input class="form-check-input" type="checkbox" id="select-all-modified">
                                    </th>
                                    <th width="35%">Name</th>
                                    <th width="40%">Description</th>
                                    <th width="8%">Type</th>
                                    <th width="15%">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Root level terms section -->
                                <tr class="glossary-tree-header">
                                    <td colspan="5" class="bg-light">
                                        <div class="d-flex align-items-center">
                                            <span class="toggle-node-children me-2" data-bs-toggle="collapse" data-bs-target="#modified-root-terms" role="button" aria-expanded="true" aria-controls="modified-root-terms">
                                                <i class="fas fa-caret-right"></i>
                                            </span>
                                            <span class="node-icon me-2">
                                                <i class="fas fa-tags text-info"></i>
                                            </span>
                                            <span><strong>Root Level Terms</strong></span>
                                            {% with root_terms_count=modified_root_terms|length %}
                                            {% if root_terms_count > 0 %}
                                            <span class="badge bg-info ms-2">{{ root_terms_count }}</span>
                                            {% endif %}
                                            {% endwith %}
                                        </div>
                                    </td>
                                </tr>
                                
                                <tr class="collapse show" id="modified-root-terms">
                                    <td colspan="5" class="p-0">
                                        <table class="table table-hover mb-0 w-100">
                                            {% for term in modified_root_terms %}
                                            <tr class="glossary-item term-item">
                                                <td width="2%">
                                                    <input class="form-check-input term-checkbox" type="checkbox" data-term-id="{{ term.id }}" data-item-type="term">
                                                </td>
                                                <td width="35%">
                                                    <div class="d-flex align-items-center">
                                                        <span class="toggle-node-children invisible me-2">
                                                            <i class="fas fa-caret-right"></i>
                                                        </span>
                                                        <span class="node-icon me-2">
                                                            <i class="fas fa-tag text-info"></i>
                                                        </span>
                                                        <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="text-decoration-none">
                                                            {{ term.name }}
                                                        </a>
                                                        <span class="badge bg-warning ms-2">Modified</span>
                                                    </div>
                                                </td>
                                                <td width="40%">
                                                    <div class="description-preview">{{ term.description|default:"No description" }}</div>
                                                </td>
                                                <td width="8%">
                                                    <span class="badge bg-info badge-category">Term</span>
                                                </td>
                                                <td width="15%">
                                                    <div class="btn-group" role="group">
                                                        <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                            <i class="fas fa-eye"></i>
                                                        </a>
                                                        <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-secondary" title="Edit">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                        {% if has_git_integration %}
                                                        <button type="button" class="btn btn-sm btn-outline-primary add-term-to-git-pr" 
                                                                data-term-id="{{ term.id }}" title="Add to GitHub PR">
                                                            <i class="fab fa-github"></i>
                                                        </button>
                                                        {% endif %}
                                                        <button type="button" class="btn btn-sm btn-outline-danger delete-term" 
                                                                data-bs-toggle="modal" data-bs-target="#deleteTermModal"
                                                                data-term-id="{{ term.id }}" data-term-name="{{ term.name }}" title="Delete">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                                {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                                
                                <!-- Root level nodes section -->
                                <tr class="glossary-tree-header">
                                    <td colspan="5" class="bg-light">
                                        <div class="d-flex align-items-center">
                                            <span class="toggle-node-children me-2" data-bs-toggle="collapse" data-bs-target="#modified-root-nodes" role="button" aria-expanded="true" aria-controls="modified-root-nodes">
                                                <i class="fas fa-caret-right"></i>
                                            </span>
                                            <span class="node-icon me-2">
                                                <i class="fas fa-folder text-warning"></i>
                                            </span>
                                            <span><strong>Root Level Nodes</strong></span>
                                            {% with root_nodes_count=modified_nodes|length %}
                                            {% if root_nodes_count > 0 %}
                                            <span class="badge bg-warning ms-2">{{ root_nodes_count }}</span>
                                            {% endif %}
                                            {% endwith %}
                                            </div>
                                    </td>
                                </tr>
                                
                                <tr class="collapse show" id="modified-root-nodes">
                                    <td colspan="5" class="p-0">
                                        <table class="table table-hover mb-0 w-100">
                                            {% for node in modified_nodes %}
                                            <tr class="glossary-item node-item">
                                                <td width="2%">
                                                    <input class="form-check-input node-checkbox" type="checkbox" data-node-id="{{ node.id }}" data-item-type="node">
                                                </td>
                                                <td width="35%">
                                                    <div class="d-flex align-items-center">
                                                        <span class="toggle-node-children me-2" {% if node.children|length > 0 or node.terms|length > 0 %}data-bs-toggle="collapse" data-bs-target="#modified-node-{{ node.id }}-children"{% else %}style="visibility: hidden;"{% endif %}>
                                                            <i class="fas fa-caret-right"></i>
                                                        </span>
                                                        <span class="node-icon me-2">
                                                            <i class="fas fa-folder text-warning"></i>
                                                        </span>
                                                        <a href="{% url 'metadata_manager:glossary_node_detail' node.id %}" class="text-decoration-none">
                                                            {{ node.name }}
                                                        </a>
                                                        <span class="badge bg-warning ms-2">Modified</span>
                                        </div>
                                                </td>
                                                <td width="40%">
                                                    <div class="description-preview">{{ node.description|default:"No description" }}</div>
                                                </td>
                                                <td width="8%">
                                                    <span class="badge bg-warning badge-category">Node</span>
                                                </td>
                                                <td width="15%">
                                                    <div class="btn-group" role="group">
                                                        <a href="{% url 'metadata_manager:glossary_node_detail' node.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                            <i class="fas fa-eye"></i>
                                                        </a>
                                                        <a href="{% url 'metadata_manager:glossary_node_detail' node.id %}" class="btn btn-sm btn-outline-secondary" title="Edit">
                                                            <i class="fas fa-edit"></i>
                                                        </a>
                                                        {% if has_git_integration %}
                                                        <button type="button" class="btn btn-sm btn-outline-primary add-node-to-git-pr" 
                                                                data-node-id="{{ node.id }}" title="Add to GitHub PR">
                                                            <i class="fab fa-github"></i>
                                                        </button>
                                        {% endif %}
                                                        <button type="button" class="btn btn-sm btn-outline-danger delete-node" 
                                                                data-bs-toggle="modal" data-bs-target="#deleteNodeModal"
                                                                data-node-id="{{ node.id }}" data-node-name="{{ node.name }}" title="Delete">
                                                            <i class="fas fa-trash"></i>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                            
                                            <!-- Node's children and terms -->
                                            {% if node.children|length > 0 or node.terms|length > 0 %}
                                            <tr class="collapse" id="modified-node-{{ node.id }}-children">
                                                <td colspan="5" class="p-0">
                                                    <table class="table table-hover mb-0 w-100">
                                                        {% for child in node.children %}
                                                        <tr class="glossary-item node-item node-level-1">
                                                            <td width="2%">
                                                                <input class="form-check-input node-checkbox" type="checkbox" data-node-id="{{ child.id }}" data-item-type="node">
                                                            </td>
                                                            <td width="35%">
                                                                <div class="d-flex align-items-center">
                                                                    <span class="toggle-node-children me-2" {% if child.children|length > 0 or child.terms|length > 0 %}data-bs-toggle="collapse" data-bs-target="#modified-node-{{ child.id }}-children"{% else %}style="visibility: hidden;"{% endif %}>
                                                                        <i class="fas fa-caret-right"></i>
                                                                    </span>
                                                                    <span class="node-icon me-2">
                                                                        <i class="fas fa-folder text-warning"></i>
                                                                    </span>
                                                                    <a href="{% url 'metadata_manager:glossary_node_detail' child.id %}" class="text-decoration-none">
                                                                        {{ child.name }}
                                                                    </a>
                                                                    <span class="badge bg-warning ms-2">Modified</span>
                                                                </div>
                                                            </td>
                                                            <td width="40%">
                                                                <div class="description-preview">{{ child.description|default:"No description" }}</div>
                                                            </td>
                                                            <td width="8%">
                                                                <span class="badge bg-warning badge-category">Node</span>
                                                            </td>
                                                            <td width="15%">
                                                                <div class="btn-group" role="group">
                                                                    <a href="{% url 'metadata_manager:glossary_node_detail' child.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                                        <i class="fas fa-eye"></i>
                                                                    </a>
                                                                    <a href="{% url 'metadata_manager:glossary_node_detail' child.id %}" class="btn btn-sm btn-outline-secondary" title="Edit">
                                                                        <i class="fas fa-edit"></i>
                                                                    </a>
                                                                    {% if has_git_integration %}
                                                                    <button type="button" class="btn btn-sm btn-outline-primary add-node-to-git-pr" 
                                                                            data-node-id="{{ child.id }}" title="Add to GitHub PR">
                                                                        <i class="fab fa-github"></i>
                                                                    </button>
                                    {% endif %}
                                                                    <button type="button" class="btn btn-sm btn-outline-danger delete-node" 
                                                                            data-bs-toggle="modal" data-bs-target="#deleteNodeModal"
                                                                            data-node-id="{{ child.id }}" data-node-name="{{ child.name }}" title="Delete">
                                                                        <i class="fas fa-trash"></i>
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                {% endfor %}
                                                        
                                                        {% for term in node.terms %}
                                                        <tr class="glossary-item term-item node-level-1">
                                                            <td width="2%">
                                                                <input class="form-check-input term-checkbox" type="checkbox" data-term-id="{{ term.id }}" data-item-type="term">
                                                            </td>
                                                            <td width="35%">
                                                                <div class="d-flex align-items-center">
                                                                    <span class="toggle-node-children invisible me-2">
                                                                        <i class="fas fa-caret-right"></i>
                                                                    </span>
                                                                    <span class="node-icon me-2">
                                                                        <i class="fas fa-tag text-info"></i>
                                                                    </span>
                                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="text-decoration-none">
                                                                        {{ term.name }}
                                                                    </a>
                                                                    <span class="badge bg-warning ms-2">Modified</span>
                            </div>
                                                            </td>
                                                            <td width="40%">
                                                                <div class="description-preview">{{ term.description|default:"No description" }}</div>
                                                            </td>
                                                            <td width="8%">
                                                                <span class="badge bg-info badge-category">Term</span>
                                                            </td>
                                                            <td width="15%">
                                                                <div class="btn-group" role="group">
                                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-primary" title="View Details">
                                                                        <i class="fas fa-eye"></i>
                                                                    </a>
                                                                    <a href="{% url 'metadata_manager:glossary_term_detail' term.id %}" class="btn btn-sm btn-outline-secondary" title="Edit">
                                                                        <i class="fas fa-edit"></i>
                                                                    </a>
                                                                    {% if has_git_integration %}
                                                                    <button type="button" class="btn btn-sm btn-outline-primary add-term-to-git-pr" 
                                                                            data-term-id="{{ term.id }}" title="Add to GitHub PR">
                                                                        <i class="fab fa-github"></i>
                                                                    </button>
                                                                    {% endif %}
                                                                    <button type="button" class="btn btn-sm btn-outline-danger delete-term" 
                                                                            data-bs-toggle="modal" data-bs-target="#deleteTermModal"
                                                                            data-term-id="{{ term.id }}" data-term-name="{{ term.name }}" title="Delete">
                                                                        <i class="fas fa-trash"></i>
                                                                    </button>
                        </div>
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </table>
                                                </td>
                                            </tr>
                                            {% endif %}
                                            {% endfor %}
                                        </table>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Node Modal -->
<div class="modal fade" id="createNodeModal" tabindex="-1" aria-labelledby="createNodeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="{% url 'metadata_manager:glossary_list' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="createNodeModalLabel">Create Glossary Node</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="node-name" class="form-label">Node Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="node-name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="node-description" class="form-label">Description</label>
                        <textarea class="form-control" id="node-description" name="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="parent-node" class="form-label">Parent Node</label>
                        <select class="form-select" id="parent-node" name="parent_id">
                            <option value="">No parent (root node)</option>
                            {% for node in nodes %}
                                <option value="{{ node.id }}">{{ node.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Node</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Create Term Modal -->
<div class="modal fade" id="createTermModal" tabindex="-1" aria-labelledby="createTermModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="{% url 'metadata_manager:glossary_term_create' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title" id="createTermModalLabel">Create Glossary Term</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="term-name" class="form-label">Term Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="term-name" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label for="term-description" class="form-label">Description</label>
                        <textarea class="form-control" id="term-description" name="description" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="parent-node-for-term" class="form-label">Parent Node</label>
                        <select class="form-select" id="parent-node-for-term" name="parent_node_id">
                            <option value="">Root level (no parent)</option>
                            {% for node in nodes %}
                                <option value="{{ node.id }}">{{ node.name }}</option>
                            {% endfor %}
                        </select>
                        <div class="form-text">Terms can be created at the root level or under a node.</div>
                    </div>
                    <div class="mb-3">
                        <label for="term-source" class="form-label">Term Source</label>
                        <input type="text" class="form-control" id="term-source" name="term_source" placeholder="Optional source of this term">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Create Term</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Delete Node Modal -->
<div class="modal fade" id="deleteNodeModal" tabindex="-1" aria-labelledby="deleteNodeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteNodeModalLabel">Delete Glossary Node</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete the node <strong id="delete-node-name"></strong>?</p>
                <p class="text-danger">This action cannot be undone. All child nodes and terms will be lost!</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="delete-node-form" method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete">
                    <button type="submit" class="btn btn-danger">Delete Node</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Delete Term Modal -->
<div class="modal fade" id="deleteTermModal" tabindex="-1" aria-labelledby="deleteTermModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteTermModalLabel">Delete Glossary Term</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete the term <strong id="delete-term-name"></strong>?</p>
                <p class="text-danger">This action cannot be undone.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form id="delete-term-form" method="post" action="">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete">
                    <button type="submit" class="btn btn-danger">Delete Term</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- GitHub PR Modal -->
<div class="modal fade" id="githubPrModal" tabindex="-1" aria-labelledby="githubPrModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="githubPrModalLabel">Add to GitHub PR</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="github-environment" class="form-label">GitHub Environment</label>
                    <input type="text" class="form-control" id="github-environment" name="environment" required>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-primary" id="submit-github-pr">Submit</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
        // Toggle node children with animation
        $(document).on('click', '.toggle-node-children', function() {
            $(this).find('i').toggleClass('fa-rotate-90');
        });
        
        // Expand all nodes
        $('#expand-all-glossary, #expand-all-local, #expand-all-remote, #expand-all-modified').click(function() {
            const tabId = $(this).closest('.tab-pane').attr('id');
            $(`#${tabId} .collapse`).collapse('show');
            $(`#${tabId} .toggle-node-children i`).addClass('fa-rotate-90');
        });
        
        // Collapse all nodes
        $('#collapse-all-glossary, #collapse-all-local, #collapse-all-remote, #collapse-all-modified').click(function() {
            const tabId = $(this).closest('.tab-pane').attr('id');
            $(`#${tabId} .collapse`).collapse('hide');
            $(`#${tabId} .toggle-node-children i`).removeClass('fa-rotate-90');
    });
    
    // Select all checkboxes
        $('#select-all-synced, #select-all-local, #select-all-remote, #select-all-modified').change(function() {
            const tabId = $(this).closest('.tab-pane').attr('id');
            const isChecked = $(this).prop('checked');
            $(`#${tabId} .node-checkbox, #${tabId} .term-checkbox`).prop('checked', isChecked);
        });
        
        // Filter items in each tab
        $('#synced-search, #local-search, #remote-search, #modified-search').on('keyup', function() {
            const tabId = $(this).closest('.tab-pane').attr('id');
            const searchTerm = $(this).val().toLowerCase();
            
            if (searchTerm.length > 0) {
                $(`#${tabId} .glossary-item`).each(function() {
                    const text = $(this).text().toLowerCase();
                    const match = text.indexOf(searchTerm) > -1;
                    $(this).toggle(match);
                });
            } else {
                $(`#${tabId} .glossary-item`).show();
            }
        });
        
        // Clear filters
        $('#synced-clear-filter, #local-clear-filter, #remote-clear-filter, #modified-clear-filter').click(function() {
            const tabId = $(this).closest('.tab-pane').attr('id');
            $(`#${tabId}-search`).val('');
            $(`#${tabId} .glossary-item`).show();
        });
        
        // Handle batch actions
        $('#push-selected-items').click(function() {
            const selectedNodes = $('.node-checkbox:checked').map(function() {
                return $(this).data('node-id');
            }).get();
            
            const selectedTerms = $('.term-checkbox:checked').map(function() {
                return $(this).data('term-id');
            }).get();
        
        if (selectedNodes.length === 0 && selectedTerms.length === 0) {
                alert('Please select at least one item to push to DataHub.');
            return;
        }
        
            // Submit form with selected items
            const form = $('<form action="{% url "metadata_manager:glossary_list" %}" method="post"></form>');
            form.append('{% csrf_token %}');
            form.append('<input type="hidden" name="action" value="push_selected">');
            
            selectedNodes.forEach(function(nodeId) {
                form.append(`<input type="hidden" name="selected_nodes" value="${nodeId}">`);
            });
            
            selectedTerms.forEach(function(termId) {
                form.append(`<input type="hidden" name="selected_terms" value="${termId}">`);
            });
            
            $('body').append(form);
        form.submit();
        });
        
        // Add to GitHub PR action
        $('#add-selected-to-git').click(function() {
            const selectedNodes = $('.node-checkbox:checked').map(function() {
                return $(this).data('node-id');
            }).get();
            
            const selectedTerms = $('.term-checkbox:checked').map(function() {
                return $(this).data('term-id');
            }).get();
        
        if (selectedNodes.length === 0 && selectedTerms.length === 0) {
                alert('Please select at least one item to add to GitHub PR.');
            return;
        }
        
            // Open GitHub PR modal
            $('#githubPrModal').modal('show');
            
            // Store selected items in the modal form
            $('#github-pr-form').data('selected-nodes', selectedNodes);
            $('#github-pr-form').data('selected-terms', selectedTerms);
        });
        
        // GitHub PR form submission
        $('#github-pr-form').submit(function(e) {
            e.preventDefault();
            
            const selectedNodes = $(this).data('selected-nodes') || [];
            const selectedTerms = $(this).data('selected-terms') || [];
            const environment = $('#github-environment').val();
            
            // Submit form with selected items
            const form = $('<form action="{% url "metadata_manager:glossary_list" %}" method="post"></form>');
            form.append('{% csrf_token %}');
            form.append('<input type="hidden" name="action" value="add_to_git">');
            form.append(`<input type="hidden" name="environment" value="${environment}">`);
            
            selectedNodes.forEach(function(nodeId) {
                form.append(`<input type="hidden" name="selected_nodes" value="${nodeId}">`);
            });
            
            selectedTerms.forEach(function(termId) {
                form.append(`<input type="hidden" name="selected_terms" value="${termId}">`);
            });
            
            $('body').append(form);
        form.submit();
        });
        
        // Push all items
        $('#push-all-items').click(function() {
            if (!confirm('Are you sure you want to push all local and modified items to DataHub?')) {
            return;
        }
        
            // Submit form to push all items
            const form = $('<form action="{% url "metadata_manager:glossary_list" %}" method="post"></form>');
            form.append('{% csrf_token %}');
            form.append('<input type="hidden" name="action" value="push_all">');
            $('body').append(form);
        form.submit();
        });
        
        // Download selected items
        $('#download-selected-items').click(function() {
            const selectedNodes = $('.node-checkbox:checked').map(function() {
                return $(this).data('node-id');
            }).get();
            
            const selectedTerms = $('.term-checkbox:checked').map(function() {
                return $(this).data('term-id');
            }).get();
        
        if (selectedNodes.length === 0 && selectedTerms.length === 0) {
                alert('Please select at least one item to download.');
            return;
        }
        
            // TODO: Implement download functionality
            alert('Download functionality not yet implemented.');
        });
        
        // Download all items
        $('#download-all-items').click(function() {
            // TODO: Implement download functionality
            alert('Download functionality not yet implemented.');
    });
});
</script>
{% endblock %} 